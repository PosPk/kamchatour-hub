"use strict";(()=>{var e={};e.id=76,e.ids=[76],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},2615:e=>{e.exports=require("http")},5240:e=>{e.exports=require("https")},8621:e=>{e.exports=require("punycode")},6162:e=>{e.exports=require("stream")},7360:e=>{e.exports=require("url")},1568:e=>{e.exports=require("zlib")},8207:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>h,patchFetch:()=>x,requestAsyncStorage:()=>d,routeModule:()=>c,serverHooks:()=>l,staticGenerationAsyncStorage:()=>m});var a={};r.r(a),r.d(a,{POST:()=>u});var o=r(3278),s=r(5002),n=r(4877),i=r(1309),p=r(5932);async function u(e){try{let t=await e.json().catch(()=>({})),r=Array.isArray(t?.messages)?t.messages:[],a=`Страницы сайта (маршруты):
— Хаб: /
— Безопасность: /hub/safety (SOS, МЧС, сейсмика)
— Размещение (онбординг в кабинете): /stays/onboarding (operator-web)
— Сувениры (витрина будет): /hub/souvenirs
— Туристам (моб. страница, в работе): /tourists (если включена)
— Партнёры: /partners, Поиск: /search
— VIP витрины: /premium (Commerce), /premium2 (Adventure)
Подсказки: \xabОткрой безопасность\xbb, \xabПокажи сувениры\xbb, \xabГде зарегистрировать группу МЧС?\xbb`,o=process.env.OPENROUTER_API_KEY,s=process.env.SUPABASE_URL,n=process.env.SUPABASE_SERVICE_ROLE,u=s&&n?(0,p.eI)(s,n):null,c=Date.now();if(o){let e=await fetch("https://openrouter.ai/api/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${o}`},body:JSON.stringify({model:"openai/gpt-4o-mini",messages:[{role:"system",content:"Ты — AI.Kam, администратор экосистемы Kamchatour. Помогаешь туристам и партнёрам: туры, безопасность, календарь, рефералы, экобаллы. Отвечай кратко и по делу. Если просят перейти, предлагай прямые ссылки по карте сайта. "+a},...r]})});if(!e.ok){let t=await e.text();return i.NextResponse.json({error:"upstream_error",detail:t},{status:502})}let t=await e.json(),s=t?.choices?.[0]?.message?.content??"Готово.";return u&&await u.from("ai_usage_logs").insert({provider:"openrouter",model:"openai/gpt-4o-mini",tokens_in:0,tokens_out:0,cost_usd:.002,duration_ms:Date.now()-c,created_at:new Date().toISOString()}),i.NextResponse.json({content:s})}let d=r[r.length-1]?.content||"",m="AI.Kam (демо): я зафиксировал ваш запрос. На проде тут будет полноценный ИИ (OpenRouter). Вопрос: "+("string"==typeof d?d.slice(0,240):"");return i.NextResponse.json({content:m})}catch(e){return i.NextResponse.json({error:"bad_request",detail:String(e?.message||e)},{status:400})}}let c=new o.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/ai/chat/route",pathname:"/api/ai/chat",filename:"route",bundlePath:"app/api/ai/chat/route"},resolvedPagePath:"/workspace/landing-web/src/app/api/ai/chat/route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:d,staticGenerationAsyncStorage:m,serverHooks:l}=c,h="/api/ai/chat/route";function x(){return(0,n.patchFetch)({serverHooks:l,staticGenerationAsyncStorage:m})}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[787,833,932],()=>r(8207));module.exports=a})();