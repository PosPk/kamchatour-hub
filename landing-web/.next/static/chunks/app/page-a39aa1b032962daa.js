(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{7287:function(e,t,o){Promise.resolve().then(o.t.bind(o,2972,23)),Promise.resolve().then(o.bind(o,1523)),Promise.resolve().then(o.bind(o,49)),Promise.resolve().then(o.bind(o,3644)),Promise.resolve().then(o.bind(o,1336)),Promise.resolve().then(o.bind(o,1730))},7648:function(e,t,o){"use strict";o.d(t,{default:function(){return r.a}});var n=o(2972),r=o.n(n)},1523:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"BailoutToCSR",{enumerable:!0,get:function(){return r}});let n=o(8993);function r(e){let{reason:t,children:o}=e;if("undefined"==typeof window)throw new n.BailoutToCSRError(t);return o}},49:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"PreloadCss",{enumerable:!0,get:function(){return a}});let n=o(7437),r=o(544);function a(e){let{moduleIds:t}=e;if("undefined"!=typeof window)return null;let o=(0,r.getExpectedRequestStore)("next/dynamic css"),a=[];if(o.reactLoadableManifest&&t){let e=o.reactLoadableManifest;for(let o of t){if(!e[o])continue;let t=e[o].files.filter(e=>e.endsWith(".css"));a.push(...t)}}return 0===a.length?null:(0,n.jsx)(n.Fragment,{children:a.map(e=>(0,n.jsx)("link",{precedence:"dynamic",rel:"stylesheet",href:o.assetPrefix+"/_next/"+encodeURI(e),as:"style"},e))})}},3644:function(e,t,o){"use strict";o.r(t),o.d(t,{default:function(){return a}});var n=o(7437),r=o(2265);function a(e){let{showPoints:t=!1,className:a}=e,i=(0,r.useRef)(null);return(0,r.useEffect)(()=>{let e;return(async()=>{let n=await o.e(212).then(o.t.bind(o,759,23));if(await Promise.all([o.e(641),o.e(46)]).then(o.t.bind(o,5046,23)),!i.current)return;e=n.map(i.current,{zoomControl:!1,attributionControl:!1,dragging:!1,scrollWheelZoom:!1,doubleClickZoom:!1,boxZoom:!1,keyboard:!1}).setView([56,160],5),n.tileLayer("",{}).addTo(e);let r=await fetch("/data/kamchatka_outline.geojson"),a=await r.json();n.geoJSON(a,{style:{color:"#FFD700",weight:6,fill:!1,opacity:.18,lineCap:"round",lineJoin:"round"}}).addTo(e);let l=n.geoJSON(a,{style:{color:"#FFD700",weight:2.5,fill:!1,opacity:.95,lineCap:"round",lineJoin:"round"}}).addTo(e);try{e.fitBounds(l.getBounds(),{padding:[10,10]})}catch(e){}if(t){let t=await fetch("/data/bears.geojson"),o=await t.json(),r=e=>n.divIcon({html:'<div style="background:'.concat("high"===e?"#FF3B30":"medium"===e?"#FF9500":"#34C759",';width:12px;height:12px;border-radius:50%;border:2px solid rgba(255,255,255,0.9)"></div>'),className:"",iconSize:[12,12]});n.geoJSON(o,{pointToLayer:(e,t)=>{var o;return n.marker(t,{icon:r((null===(o=e.properties)||void 0===o?void 0:o.severity)||"low")})},onEachFeature:(e,t)=>{let o=e.properties||{};t.bindPopup("<b>".concat(o.title||"Наблюдение","</b><br/>Статус: ").concat(o.severity||"-","<br/>Дата: ").concat(o.date||"-"))}}).addTo(e)}})(),()=>{try{null==e||e.remove()}catch(e){}}},[]),(0,n.jsx)("div",{ref:i,className:"w-full h-72 rounded-2xl overflow-hidden border border-white/10 bg-black ".concat(a||"")})}},1336:function(e,t,o){"use strict";o.r(t),o.d(t,{default:function(){return a}});var n=o(7437),r=o(2265);function a(){let[e,t]=(0,r.useState)(!1),[o,a]=(0,r.useState)("Привет! Подскажи популярные туры и безопасность."),[i,l]=(0,r.useState)([{role:"assistant",content:"Я AI.Kam — ИИ‑администратор. Чем помочь?"}]),s=(0,r.useRef)(null);(0,r.useEffect)(()=>{var e;null===(e=s.current)||void 0===e||e.scrollTo({top:999999,behavior:"smooth"})},[i,e]);let c=async()=>{if(!o.trim())return;let e=[...i,{role:"user",content:o}];l(e),a("");try{let t=await fetch("/api/ai/chat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({messages:e})}),o=await t.json();l([...e,{role:"assistant",content:(null==o?void 0:o.content)||"Ок."}])}catch(t){l([...e,{role:"assistant",content:"Ошибка сети, попробуйте позже."}])}};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("button",{onClick:()=>t(!e),className:"fixed z-50 bottom-5 right-5 h-12 px-4 rounded-full bg-premium-gold text-premium-black font-bold shadow-lg",children:e?"Закрыть AI.Kam":"AI.Kam • помощь"}),e&&(0,n.jsxs)("div",{className:"fixed z-50 bottom-20 right-5 w-[min(92vw,360px)] rounded-2xl bg-black/80 backdrop-blur border border-white/10 overflow-hidden",children:[(0,n.jsx)("div",{className:"px-4 py-3 border-b border-white/10 font-bold",children:"AI.Kam — ИИ‑администратор"}),(0,n.jsx)("div",{ref:s,className:"h-64 overflow-y-auto px-4 py-3 space-y-3",children:i.map((e,t)=>(0,n.jsx)("div",{className:"assistant"===e.role?"text-white/90":"text-premium-gold",children:e.content},t))}),(0,n.jsxs)("div",{className:"p-3 flex gap-2",children:[(0,n.jsx)("input",{value:o,onChange:e=>a(e.target.value),placeholder:"Спросите у AI.Kam…",className:"flex-1 h-10 rounded-xl px-3 text-slate-900"}),(0,n.jsx)("button",{onClick:c,className:"h-10 px-4 rounded-xl bg-premium-gold text-premium-black font-bold",children:"Отправить"})]})]})]})}},1730:function(e,t,o){"use strict";o.d(t,{default:function(){return i}});var n=o(7437),r=o(7648),a=o(2265);function i(){let[e,t]=(0,a.useState)(null);(0,a.useEffect)(()=>{let e=!0;return(async()=>{try{var o;let n=await fetch("/data/kamchatka_outline.geojson"),r=await n.json(),a="FeatureCollection"===r.type?null===(o=r.features)||void 0===o?void 0:o[0]:r;(null==a?void 0:a.geometry)&&e&&t(a.geometry)}catch(e){console.error("Failed to load GeoJSON outline",e)}})(),()=>{e=!1}},[]);let o=(0,a.useMemo)(()=>e?function(e,t,o){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:8,{minLon:r,minLat:a,maxLon:i,maxLat:l}=function(e){let t=1/0,o=1/0,n=-1/0,r=-1/0,a=(e,a)=>{e<t&&(t=e),e>n&&(n=e),a<o&&(o=a),a>r&&(r=a)};return(e=>{for(let t of Array.isArray(e[0][0])?e:[e])for(let e of t)for(let[t,o]of e)a(t,o)})(e.coordinates),{minLon:t,minLat:o,maxLon:n,maxLat:r}}(e),s=Math.max(1e-9,i-r),c=Math.max(1e-9,l-a),d=Math.min((t-2*n)/s,(o-2*n)/c),u=(t-s*d)/2-r*d,f=(o-c*d)/2+l*d,h=(e,t)=>[u+e*d,f-t*d],m=[];for(let t of Array.isArray(e.coordinates[0][0])?e.coordinates:[e.coordinates])for(let e of t){let t=e.map(e=>{let[t,o]=e;return h(t,o)});if(t.length){m.push("M ".concat(t[0][0].toFixed(2)," ").concat(t[0][1].toFixed(2)));for(let e=1;e<t.length;e++)m.push("L ".concat(t[e][0].toFixed(2)," ").concat(t[e][1].toFixed(2)));m.push("Z")}}return m.join(" ")}(e,500,600,10):"",[e]);return(0,n.jsx)(r.default,{href:"/hub/safety","aria-label":"Открыть карту Камчатки",className:"kamchatka-button inline-block",children:(0,n.jsx)("svg",{viewBox:"0 0 ".concat(500," ").concat(600),width:500,height:600,className:"w-full h-auto",preserveAspectRatio:"xMidYMid meet",children:o&&(0,n.jsx)("path",{d:o,className:"kamchatka-path",vectorEffect:"non-scaling-stroke",shapeRendering:"geometricPrecision"})})})}}},function(e){e.O(0,[972,971,117,744],function(){return e(e.s=7287)}),_N_E=e.O()}]);