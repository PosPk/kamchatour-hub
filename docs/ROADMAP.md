# Roadmap (персон по ролям)

Документ с приоритетами и вехами по ролям. Фокус: P0 (MVP), затем P1/P2.

## Вехи
- M0 (MVP, P0): бронирование тура/трансфера с оплатой, базовая аналитика, стабильные сборки, документация.
- M1 (P1): билеты (QR), серверная синхронизация тотемов, улучшенный UX, мониторинг/алерты, e2e.
- M2 (P2): карта офлайн, модерация UGC, расширенные интеграции, A/B‑эксперименты.

---

## Product Manager
- P0
  - Определить North Star и KPI (конверсия поиск→покупка, time‑to‑booking)
  - Утвердить релизный календарь и партнёрские SLA
- P1
  - Подготовить GTM‑план и цикл сбора обратной связи

## Solution/Software Architect
- P0
  - ADR по платежам/чекауту (идемпотентность, вебхуки, reconcile)
  - Финализация схем `bookings`/`payments`/`refunds` с RLS
- P1
  - План масштабирования Realtime/кешей, индексы и автовакаум

## Lead React Native Engineer
- P0
  - Завершить чекаут e2e: экраны, `PaymentStatus` deep link, ошибки/повторы
  - Производительность списков, skeleton/loading, доступность базовая
- P1
  - Валидация билетов (QR), офлайн‑фолбэки для карт/ленты

## Backend/Supabase Engineer
- P0
  - Вебхуки CloudPayments: HMAC, статусы, идемпотентность по `action_id`
  - Reconciliation и события статусов (Realtime channels)
- P1
  - Refund/void флоу, журнал аудита, индексы и partial indexes

## DevOps/CI/CD Engineer
- P0
  - Разделение окружений dev/stage/prod, секреты и ротация
  - Sentry/логирование, алерты пайплайнов, артефакты
- P1
  - Канареечные релизы, кеш‑стратегии EAS/Expo

## UI/UX Designer
- P0
  - Чекаут UX: 3DS/ошибки/повторы, пустые состояния и подсказки
  - Легенды/микро‑UX в трансфере, доступность ключевых экранов
- P1
  - Карта наблюдений (фильтры/кластеризация), улучшение фида

## QA Engineer
- P0
  - e2e сценарии: поиск→чекаут→оплата→вебхук→статус
  - Негативные кейсы: 3DS fail, повторная оплата, истечение hold
- P1
  - Нагрузочное тестирование API и Realtime

## Security/Compliance
- P0
  - Полные RLS политики, секрет‑скан, журнал аудита доступов
  - Процедуры ротации ключей и HMAC валидация
- P1
  - GDPR/PII ревью, минимизация данных в логах

## Payments/Fintech Integrator
- P0
  - 3DS/Pay/Fail флоу, идемпотентность, обработка edge‑кейсов
  - Reconcile отчёты, маппинг статусов в `bookings`
- P1
  - Возвраты/partial capture, спорные транзакции

## Data/Analytics
- P0
  - Спецификация событий воронки, валидация трекинга
  - Базовые дашборды (конверсия, тайминги, отказы)
- P1
  - Подготовка к A/B тестам, когортный анализ

## Map/GIS Engineer
- P1
  - Кластеризация, офлайн тайлы, фильтры по периодам/типам наблюдений

## AI Engineer
- P1
  - Сценарии подсказок (поиск туров, трансфер, безопасность), лимиты токенов/стоимости

## Content/Community
- P2
  - Модерация UGC, жалобы/блокировки, контент‑планы, локализация

## Partnerships/Operations
- P2
  - Онбординг операторов/перевозчиков, импорты данных, SLA

---

## Карта задач (сквозные P0)
- Checkout E2E (вебхуки, idempotency, PaymentStatus, reconcile)
- Transfer QR tickets (issue/validate)
- Totems sync (RPC + Realtime)
- QA e2e критические пути
- DevOps: envs + Sentry
- Security: RLS политики
- UX: пустые состояния, skeletons, доступность
- Analytics: дашборды KPI

---

## Приоритеты реализации (ориентиры)

### P0 (MVP, 2–3 недели)
- Типобезопасность/сборка зелёная: выровнять типы, удалить дубликаты
- Схема БД: `bookings/payments` c идемпотентностью (`action_id`), индексы
- Вебхук CloudPayments: гарантированный raw body (HMAC), идемпотентность, reconcile лог
- Чекаут E2E: поиск→hold→book→init pay→webhook→статус (≥1 e2e Playwright)
- Демостабильность: фолбэки (orders/feed) без Supabase, единый сценарий
- Наблюдаемость/алерты: Axiom, Bugsnag/Sentry (клиент)
- CI/CD: `test:ci` в пайплайн, артефакты web, `.nvmrc` (Node 18)

### P1 (4–6 недель)
- Билеты/QR: issue/validate, офлайн‑проверка, роль «контролёр»
- Realtime: статусы брони/мест, истечение hold, каналы
- Totems: RPC + Realtime синхронизация, лимиты/идемпотентность server‑side
- Payments+: негативные флоу (3DS fail, retries), refunds/void, отчёты reconcile
- Карты (online): точки/фильтры, прогрев к офлайн‑тайлам
- Аналитика: KPI дашборды (конверсия, TTB)
- Безопасность: RLS полноценно, минимум прав, журнал аудита

### P2 (8–12 недель)
- Офлайн‑тайлы/кластеризация, AR‑витрина, push‑уведомления, i18n, A/B‑готовность