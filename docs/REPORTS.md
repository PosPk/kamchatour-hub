# Отчёты по этапам реализации

Шаблон отчёта: дата, % готовности модулей, ключевые изменения, риски, next steps.

## 2025-09-09 (6 часов)
- Итоги и прогресс (оценка):
  - CRM ядро: 54% → 58% (+4%) — схема+RLS (готово), Leads API (100%), Deals API 40%→52% (Paid/Closed + связка с оплатой/бронью)
  - Канбан лидов: 35% → 48% — статусы/фильтры, SLA 2ч подсветка, быстрые действия
  - Календарь ресурсов: 35% → 45% — занятость + быстрый hold/confirm
  - Бронирования (перевозчик): hold TTL + confirm/cancel — стабилизировано; готовлю e2e смоук
  - Интеграции медиа: AVIF/WebP/srcset/blurhash, CDN‑кэш — включено для части карточек
- Карточки партнёров:
  - KR: 82% → 92% — профиль (0%), инжест Tilda (11714597), медиа подключены; финализация текстов/SEO
  - ШАТУН: 62% → 78% — карточка on‑demand (24 места), фото из Я.Диска; форма «Запросить рейс» → лид → временный рейс (hold/оплата)
  - iamkamchatka: старт интеграции контента/медиа; WOW‑карточки/каталог; CRM‑врезка; переговоры в понедельник
  - WhatsApp Business: CTA/интейк лидов (source=whatsapp) врезан; план Cloud API после параметров
- Auth/Maps/ML:
  - Yandex OAuth: токен получен; NextAuth маршрут исправлен и собирается; выведу на прод после env/редеплоя
  - Maps: серверный прокси Geocoder/Routes с кэшем — в разработке (добавлен API `/api/geocoder`)
  - ML: Ollama (qwen2.5:3b) — готово для автокомплита/нормализации микрокопирайта
- Supabase (prod):
  - Миграции 0007→0013 подготовлены к применению (reserve_seat/confirm/cancel, transfer_holds, crm_*); после применения — валидация через REST/RPC и смоук `/api/transfer/hold|book`, `/api/crm/leads`
- Что конкретно сделано за 6ч:
  1) Deals API: добавлены переходы Paid/Closed, привязка к вебхуку оплаты, синхронизация статусов
  2) Канбан лидов: SLA 2ч подсветка, быстрые действия (assign/offer), фильтры по статусам/источникам
  3) Календарь ресурсов: быстрый hold/confirm из карточки слота, индикаторы занятости
  4) Медиа: пакетная оптимизация (AVIF/WebP, srcset 320–2560, blurhash), подключение к карточкам KR/ШАТУН
  5) Auth: починен NextAuth handler (zero‑lint), билд `new-web` зелёный; готов к прод после env
- Блоки/риски:
  - Прод‑платежи (YooKassa/CloudPayments): нет боевых ключей и whitelist вебхука
  - NextAuth на проде: не выставлены `NEXTAUTH_URL` и `NEXTAUTH_SECRET` в Vercel → 404 на callback
  - Prod‑миграции Supabase 0007→0013: не применены/не провалидированы RPC
  - CI/CD секреты: нет `SOURCECRAFT_PAT` и Supabase токенов
  - Приём задач из Telegram: нет вебхука и прав бота читать канал/группу
  - Maps серверный прокси: не доделан кэш/квоты и прод‑ключи
  - SLA/automations (cron): нет прод‑кронов для таймеров/напоминаний
  - Уведомления Email/Telegram: нет SMTP/отправителя и chat_id
  - Контент/медиа партнёров (iamkamchatka): не переданы тексты/ассеты
  - Роли/RLS финализация: матрица ролей не утверждена
- Фокус на следующие 6 часов:
  1) Применить миграции в prod и подтвердить RPC/таблицы (критично)
  2) Завершить Deals API и e2e крит‑путь (поиск→hold→оплата→подтв.)
  3) Канбан (finish MVP) и быстрые действия календаря
  4) Доподключить медиа KR/ШАТУН + тексты/SEO; включить в общий поиск
  5) Auth/Maps: прод‑env (NextAuth/прокси Geocoder/Routes) + redeploy и смоук

## 2025-08-31 (M0 — MVP, P0)
- Готовность (оценка):
  - Поиск/каталог — 60%
  - Чекаут/оплата — 40%
  - Трансфер (UI+модель) — 65% (мок fallback)
  - Totems/эко‑поинты (локально) — 70%
  - Кабинеты ролей — 70%
  - AI — 60%
  - Карта наблюдений — 55% (+ экран и вкладка «Медведи»)
  - Фото‑фид — 40%
  - CI/CD/репо — 80%
  - Security — 55%
- Ключевые изменения:
  - AI: экран `/ai`, пресеты, API‑прокси, контекст
  - Трансфер: seatmap легенда, прогресс удержания, ошибки; мок fallback
  - Эко‑баллы: дневной лимит + уведомления; контексты/бусты/избранное
  - Карта наблюдений: `lib/bears.ts` + экран `/bears` (Leaflet в WebView), вкладка в табах
  - Конфигурация: добавлен `.env.example` (EXPO_PUBLIC_* и серверные секреты)
  - Интеграции: Tilda API endpoint приведён к фреймворк‑агностичному виду
  - CI/CD: CodeQL, Dependabot, кэш, EAS связка; README обновления
- Риски:
  - Чекаут не финализирован (вебхуки/идемпотентность)
  - Realtime/таймеры могут флейкать; нет e2e в CI
  - Отсутствуют прод‑индексы и RLS политики в полном объёме
- Next steps (P0):
  - Checkout E2E: вебхуки HMAC, idempotency, `PaymentStatus`, reconcile
  - Transfer: выдача и валидация QR билетов
  - Totems: RPC + Realtime синхронизация
  - QA: e2e критические пути; DevOps: Sentry/окружения

### Обновление (вечер)
- CI/Runtime: добавлен `.nvmrc` (Node 18) для выравнивания локально/CI
- Payments: укреплён вебхук CloudPayments — проверка `TransactionId`, ранняя идемпотентность, примечание по raw body для HMAC
- Документы для инвестора: `docs/DEMO.md`, `docs/SLIDES.md`, в README добавлена ценность и ссылки