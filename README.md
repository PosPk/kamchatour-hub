# üèîÔ∏è Kamchatour Hub - –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è –ø—É—Ç–µ—à–µ—Å—Ç–≤–µ–Ω–Ω–∏–∫–æ–≤ –ø–æ –ö–∞–º—á–∞—Ç–∫–µ

–ú–Ω–æ–≥–æ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π —Ö–∞–± –¥–ª—è –ø—É—Ç–µ—à–µ—Å—Ç–≤–µ–Ω–Ω–∏–∫–æ–≤ –ø–æ –ö–∞–º—á–∞—Ç–∫–µ —Å —Ñ—É–Ω–∫—Ü–∏—è–º–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏, –∫—É–ª—å—Ç—É—Ä—ã, —ç–∫–æ–ª–æ–≥–∏–∏, –º–∞—Ä—à—Ä—É—Ç–æ–≤ –∏ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π.

## ‚ú® –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

### üö® **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**
- SOS —Å–∏—Å—Ç–µ–º–∞ —Å –≥–µ–æ–ª–æ–∫–∞—Ü–∏–µ–π
- –≠–∫—Å—Ç—Ä–µ–Ω–Ω—ã–µ –∫–æ–Ω—Ç–∞–∫—Ç—ã
- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± —É–±–µ–∂–∏—â–∞—Ö
- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ —á—Ä–µ–∑–≤—ã—á–∞–π–Ω—ã—Ö —Å–∏—Ç—É–∞—Ü–∏—è—Ö

### üé≠ **–ö—É–ª—å—Ç—É—Ä–∞**
- –ú–∞—Å—Ç–µ—Ä-–∫–ª–∞—Å—Å—ã –º–µ—Å—Ç–Ω—ã—Ö —Ä–µ–º–µ—Å–ª–µ–Ω–Ω–∏–∫–æ–≤
- –ö—É–ª—å—Ç—É—Ä–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è –∏ —Ñ–µ—Å—Ç–∏–≤–∞–ª–∏
- –ö–∞—Ä—Ç–∞ —Ä–µ–º–µ—Å–ª–µ–Ω–Ω—ã—Ö –¥–µ—Ä–µ–≤–µ–Ω—å
- AR-–ø—Ä–æ—Å–º–æ—Ç—Ä —Å—É–≤–µ–Ω–∏—Ä–æ–≤

### üåø **–≠–∫–æ–ª–æ–≥–∏—è**
- –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å–æ—Å—Ç–æ—è–Ω–∏—è –æ–∫—Ä—É–∂–∞—é—â–µ–π —Å—Ä–µ–¥—ã
- –≠–∫–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–µ —Å–æ–≤–µ—Ç—ã –¥–ª—è —Ç—É—Ä–∏—Å—Ç–æ–≤
- –û—Ç—á–µ—Ç—ã –æ —Å–æ—Å—Ç–æ—è–Ω–∏–∏ –ø—Ä–∏—Ä–æ–¥—ã
- –í–æ–ª–æ–Ω—Ç–µ—Ä—Å–∫–∏–µ –ø—Ä–æ–≥—Ä–∞–º–º—ã

### üó∫Ô∏è **–¢—É—Ä–∏–∑–º**
- –ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç—É—Ä–æ–≤ –∏ —ç–∫—Å–∫—É—Ä—Å–∏–π
- –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –Ω–∞ –ø—Ä–∏—Ä–æ–¥–µ
- –†–∞–∑–º–µ—â–µ–Ω–∏–µ –≤ —ç–∫–æ-–ª–æ–¥–∂–∞—Ö
- –ü–æ–∏—Å–∫ –∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π

## üõ†Ô∏è –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫

- **Frontend**: React Native + Expo Router
- **–Ø–∑—ã–∫**: TypeScript
- **–ù–∞–≤–∏–≥–∞—Ü–∏—è**: Expo Router —Å —Ç–∞–±–∞–º–∏
- **–°–æ—Å—Ç–æ—è–Ω–∏–µ**: React Context API
- **–•—Ä–∞–Ω–µ–Ω–∏–µ**: AsyncStorage
- **–ì–µ–æ–ª–æ–∫–∞—Ü–∏—è**: Expo Location
- **–ò–∫–æ–Ω–∫–∏**: Expo Vector Icons

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è
- Node.js 18+ 
- npm –∏–ª–∏ yarn
- Expo CLI
- Android Studio / Xcode (–¥–ª—è —ç–º—É–ª—è—Ç–æ—Ä–æ–≤)

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞

1. **–ö–ª–æ–Ω–∏—Ä—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π**
   ```bash
   git clone <repository-url>
   cd kamchatka
   ```

2. **–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏**
   ```bash
   npm install
   ```

3. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ**
   ```bash
   npm start
   ```

4. **–í—ã–±–µ—Ä–∏—Ç–µ –ø–ª–∞—Ç—Ñ–æ—Ä–º—É**
   - –ù–∞–∂–º–∏—Ç–µ `a` –¥–ª—è Android
   - –ù–∞–∂–º–∏—Ç–µ `i` –¥–ª—è iOS
   - –ù–∞–∂–º–∏—Ç–µ `w` –¥–ª—è –≤–µ–±-–≤–µ—Ä—Å–∏–∏

## üì± –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

```
app/
‚îú‚îÄ‚îÄ (tabs)/           # –û—Å–Ω–æ–≤–Ω—ã–µ —Ç–∞–±—ã –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ index.tsx     # –ì–ª–∞–≤–Ω—ã–π —ç–∫—Ä–∞–Ω
‚îÇ   ‚îú‚îÄ‚îÄ culture.tsx   # –ö—É–ª—å—Ç—É—Ä–∞
‚îÇ   ‚îú‚îÄ‚îÄ eco.tsx       # –≠–∫–æ–ª–æ–≥–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ booking.tsx   # –ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
‚îÇ   ‚îî‚îÄ‚îÄ profile.tsx   # –ü—Ä–æ—Ñ–∏–ª—å
‚îú‚îÄ‚îÄ auth/             # –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
‚îú‚îÄ‚îÄ emergency/        # –≠–∫—Å—Ç—Ä–µ–Ω–Ω—ã–µ —Å–∏—Ç—É–∞—Ü–∏–∏
‚îî‚îÄ‚îÄ _layout.tsx       # –û—Å–Ω–æ–≤–Ω–æ–π layout

components/            # –ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
‚îú‚îÄ‚îÄ ui/               # UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
‚îú‚îÄ‚îÄ safety/           # –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
‚îú‚îÄ‚îÄ culture/          # –ö—É–ª—å—Ç—É—Ä–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
‚îî‚îÄ‚îÄ eco/              # –≠–∫–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

contexts/             # React Contexts
‚îú‚îÄ‚îÄ AuthContext.tsx   # –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
‚îú‚îÄ‚îÄ LocationContext.tsx # –ì–µ–æ–ª–æ–∫–∞—Ü–∏—è
‚îî‚îÄ‚îÄ EmergencyContext.tsx # –≠–∫—Å—Ç—Ä–µ–Ω–Ω—ã–µ —Å–∏—Ç—É–∞—Ü–∏–∏

lib/                  # –ë–∏–±–ª–∏–æ—Ç–µ–∫–∏
‚îú‚îÄ‚îÄ auth.ts           # –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
‚îú‚îÄ‚îÄ emergency.ts      # –≠–∫—Å—Ç—Ä–µ–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
‚îî‚îÄ‚îÄ location.ts       # –ì–µ–æ–ª–æ–∫–∞—Ü–∏—è

hooks/                # –ö–∞—Å—Ç–æ–º–Ω—ã–µ —Ö—É–∫–∏
‚îú‚îÄ‚îÄ useAuth.ts        # –•—É–∫ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
‚îú‚îÄ‚îÄ useLocation.ts    # –•—É–∫ –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏
‚îî‚îÄ‚îÄ useEmergency.ts   # –•—É–∫ —ç–∫—Å—Ç—Ä–µ–Ω–Ω—ã—Ö —Å–∏—Ç—É–∞—Ü–∏–π
```

## üîß –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env` –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞:
```env
# API Keys (–¥–ª—è –±—É–¥—É—â–µ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è)
SUPABASE_URL=your_supabase_url
SUPABASE_ANON_KEY=your_supabase_key

# Emergency Services
EMERGENCY_API_KEY=your_emergency_api_key

# Weather API
WEATHER_API_KEY=your_weather_api_key
```

### Supabase (—Å—Ö–µ–º—ã ‚Äî –∫—Ä–∞—Ç–∫–æ)
- –¢–∞–±–ª–∏—Ü–∞ `operators`: id (text), name, website, phone, regions (text[]), activities (text[]), verified (bool), partnerLevel (text), score (int), description, logoUrl.
- –¢–∞–±–ª–∏—Ü–∞ `tours`: id, operatorId, title, region, activity, priceFrom (int), durationDays (int), rating (float), description.
- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ: `slots`, `bookings`, `messages` –∏ —Ç.–ø. –ø–æ –º–µ—Ä–µ –≤–Ω–µ–¥—Ä–µ–Ω–∏—è.

–í –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ —Ä–∞–±–æ—Ç–∞–µ—Ç –æ—Ç–ª–æ–∂–µ–Ω–Ω–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ: –ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ `SUPABASE_URL`/`SUPABASE_ANON_KEY` –¥–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç –±—Ä–∞—Ç—å—Å—è –∏–∑ –ë–î, –∏–Ω–∞—á–µ ‚Äî –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω—ã –º–æ–∫–∏.

### –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å (RLS) ‚Äî –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ
1. –í Supabase SQL Editor –ø—Ä–∏–º–µ–Ω–∏—Ç–µ —Ñ–∞–π–ª—ã `supabase/schema.sql` –∏ `supabase/rls.sql`.
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –¥–ª—è —Ç–∞–±–ª–∏—Ü –≤–∫–ª—é—á—ë–Ω RLS –∏ —Å–æ–∑–¥–∞–Ω—ã –ø–æ–ª–∏—Ç–∏–∫–∏, –∫–∞–∫ –≤ `rls.sql`.
3. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ Service Role –∫–ª—é—á –¢–û–õ–¨–ö–û –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ. –í –∫–ª–∏–µ–Ω—Ç–µ ‚Äî –∞–Ω–æ–Ω–∏–º–Ω—ã–π –∫–ª—é—á —Å RLS.
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç —Ç–æ–ª—å–∫–æ —Å–≤–æ–∏ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è, —Å–æ–æ–±—â–µ–Ω–∏—è –∏ —ç–∫–æ‚Äë–¥–µ–π—Å—Ç–≤–∏—è.

### –ê—É–¥–∏—Ç, –ø–ª–∞—Ç–µ–∂–∏ –∏ rate limiting (SQL)
–ü–æ—Ä—è–¥–æ–∫ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –≤ Supabase ‚Üí SQL Editor:
1) `supabase/schema.sql`
2) `supabase/rls.sql`
3) `supabase/audit.sql` ‚Äî —Å–æ–∑–¥–∞—ë—Ç `audit_log` –∏ —Ç—Ä–∏–≥–≥–µ—Ä—ã –Ω–∞ –∫–ª—é—á–µ–≤—ã–µ —Ç–∞–±–ª–∏—Ü—ã
4) `supabase/payments.sql` ‚Äî —Ç–∞–±–ª–∏—Ü–∞ `payments`, idempotency key + advisory lock
5) `supabase/rate_limit.sql` ‚Äî —Ç–∞–±–ª–∏—Ü–∞ `auth_attempts` –∏ —Ñ—É–Ω–∫—Ü–∏—è `check_rate_limit`
6) `supabase/announcements.sql` ‚Äî –æ–±—ä—è–≤–ª–µ–Ω–∏—è (–º–æ–¥–µ—Ä–∞—Ü–∏—è) –∏ –ª–∏–¥—ã –¥–ª—è Telegram
7) `supabase/booking.sql` ‚Äî —Å—Ç–∞—Ç—É—Å—ã –ø—Ä–µ–¥–±—Ä–æ–Ω–∏ –∏ —Å–æ–±—ã—Ç–∏—è

–ü—Ä–æ–≤–µ—Ä–∫–∏:
- –ê—É–¥–∏—Ç: –≤—ã–ø–æ–ª–Ω–∏—Ç—å INSERT/UPDATE/DELETE –≤ `bookings` –∏ —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –∑–∞–ø–∏—Å—å –ø–æ–ø–∞–ª–∞ –≤ `audit_log`.
- –ü–ª–∞—Ç–µ–∂–∏: –¥–≤–∞ –≤—ã–∑–æ–≤–∞ `create_payment_safe` —Å –æ–¥–∏–Ω–∞–∫–æ–≤—ã–º –∫–ª—é—á–æ–º –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç –æ–¥–Ω—É –∑–∞–ø–∏—Å—å.
- Rate limit: `check_rate_limit(email,'login',5,1)` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç false –ø–æ—Å–ª–µ 5 –∑–∞–ø–∏—Å–µ–π –∑–∞ –º–∏–Ω—É—Ç—É.

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏
–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –Ω–∞ –≥–µ–æ–ª–æ–∫–∞—Ü–∏—é –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ.

## üì± –î–µ–º–æ-–∞–∫–∫–∞—É–Ω—Ç

–î–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Ñ—É–Ω–∫—Ü–∏–π –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ:
- **Email**: `demo@kamchatka.ru`
- **–ü–∞—Ä–æ–ª—å**: `demo123`

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–æ–≤ TypeScript
npm run typecheck

# –õ–∏–Ω—Ç–∏–Ω–≥
npm run lint

# –°–±–æ—Ä–∫–∞
npm run build
```

## CI: –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ SQL –∫ Supabase –∏–∑ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è

Workflow: `.github/workflows/apply-supabase-sql.yml`

–°–µ–∫—Ä–µ—Ç—ã –≤ GitHub ‚Üí Settings ‚Üí Secrets and variables ‚Üí Actions:
- `SUPABASE_PGHOST` = db.<project>.supabase.co
- `SUPABASE_PGUSER` = postgres
- `SUPABASE_PGPASSWORD` = –ø–∞—Ä–æ–ª—å
- `SUPABASE_PGDATABASE` = postgres
- `SUPABASE_PGPORT` = 5432

–ó–∞–ø—É—Å–∫: Actions ‚Üí Apply Supabase SQL ‚Üí Run workflow ‚Üí apply = yes.

### Booking (–ø—Ä–µ–¥–±—Ä–æ–Ω—å) ‚Äî API

```bash
curl -X POST https://<host>/api/booking/prebook \
  -H 'Content-Type: application/json' \
  -d '{"tour_id":"t1","contact":"@user","party_size":2,"tg_user_id":"123"}'

curl -X POST https://<host>/api/booking/cancel \
  -H 'Content-Type: application/json' \
  -d '{"id":"<booking-id>","reason":"change of plans"}'
```

### –ò–º–ø–æ—Ä—Ç —Ç—É—Ä–æ–≤ –ø–∞—Ä—Ç–Ω—ë—Ä–∞

1) –ü–æ–¥–≥–æ—Ç–æ–≤—å—Ç–µ JSON (–ø—Ä–∏–º–µ—Ä: `public/partner-tours.json`)
```json
[
  {"id":"t1","title":"–†—ã–±–∞–ª–∫–∞ –Ω–∞ –ö–∞–º—á–∞—Ç–∫–µ","region":"–Æ–∂–Ω–∞—è –ö–∞–º—á–∞—Ç–∫–∞","activity":"—Ä—ã–±–∞–ª–∫–∞","price_from":55000,"duration_days":3,"rating":4.8,"operator_id":"partner_fishing_kam"}
]
```

2) –ò–º–ø–æ—Ä—Ç –≤ Supabase (–∞–¥–º–∏–Ω‚Äë—Ç–æ–∫–µ–Ω):
```bash
curl -X POST https://<host>/api/import/partner-tours \
  -H 'Content-Type: application/json' \
  -H 'x-admin-token: $ADMIN_API_TOKEN' \
  -d @public/partner-tours.json --data-urlencode "items=@-"
```

3) Telegram‚Äë–≤–∏—Ç—Ä–∏–Ω–∞ —á–∏—Ç–∞–µ—Ç `public/partner-tours.json` –∏ —Ä–µ–Ω–¥–µ—Ä–∏—Ç —Å–ø–∏—Å–æ–∫.

### Telegram –≤–∏—Ç—Ä–∏–Ω–∞: –æ–±—ä—è–≤–ª–µ–Ω–∏—è –∏ –ª–∏–¥—ã

1) –ü—Ä–∏–º–µ–Ω–∏—Ç–µ SQL:
   - `supabase/announcements.sql` ‚Äî —Å–æ–∑–¥–∞—ë—Ç —Ç–∞–±–ª–∏—Ü—ã `public.announcements` (–º–æ–¥–µ—Ä–∞—Ü–∏—è: pending/approved/rejected) –∏ `public.leads`, –≤–∫–ª—é—á–∞–µ—Ç RLS –∏ –ø–æ–ª–∏—Ç–∏–∫–∏ (–ø—É–±–ª–∏—á–Ω–æ –≤–∏–¥–Ω—ã —Ç–æ–ª—å–∫–æ `approved`).

2) –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (Vercel ‚Üí Project Settings ‚Üí Environment Variables):
   - `SUPABASE_URL`, `SUPABASE_SERVICE_ROLE_KEY` ‚Äî —Å–µ—Ä–≤–µ—Ä–Ω—ã–π –¥–æ—Å—Ç—É–ø –∏–∑ API-—Ä–æ—É—Ç–æ–≤
   - `TG_WEBHOOK_TOKEN` ‚Äî –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –≤–µ–±—Ö—É–∫–∞ `/api/tg/post`
   - `ADMIN_API_TOKEN` ‚Äî –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è `/api/admin/announcements`

3) API:
   - –í–µ–±—Ö—É–∫ Telegram –ø–æ—Å—Ç–æ–≤ ‚Üí `POST /api/tg/post` —Å –∑–∞–≥–æ–ª–æ–≤–∫–æ–º `x-telegram-token`
     - –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç –æ–±—ä—è–≤–ª–µ–Ω–∏–µ –≤ `announcements` —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º `pending`
   - –ú–æ–¥–µ—Ä–∞—Ü–∏—è:
     - `GET /api/admin/announcements?status=pending` ‚Äî —Å–ø–∏—Å–æ–∫ –Ω–∞ –º–æ–¥–µ—Ä–∞—Ü–∏—é (–∑–∞–≥–æ–ª–æ–≤–æ–∫ `x-admin-token`)
     - `POST /api/admin/announcements` ‚Äî `{ id, action: "approve" | "reject" }`
   - –õ–∏–¥—ã:
     - `POST /api/tg/lead` ‚Äî `{ name, contact, tour_id?, tg_user_id?, tg_chat_id?, payload? }`

4) –í–∏—Ç—Ä–∏–Ω–∞ Telegram (—Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã):
   - –î–æ—Å—Ç—É–ø–Ω—ã –ø–æ—Å–ª–µ –±–∏–ª–¥–∞: `/tg`, `/tg/tours/t1`, `/tg/lead`
   - –°–±–æ—Ä–∫–∞ –∫–ª–∞–¥—ë—Ç `public/*` –≤ `dist/` –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ (—Å–∫—Ä–∏–ø—Ç `build:web`)
   - –î–ª—è —Ç–µ–º–∏–∑–∞—Ü–∏–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ Telegram `themeParams` (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

## ‚öôÔ∏è CI/CD: –î–µ–ø–ª–æ–π Expo Web –Ω–∞ GitHub Pages

1. –í–∫–ª—é—á–∏—Ç–µ GitHub Pages –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è: Source = GitHub Actions.
2. Workflow —É–∂–µ –¥–æ–±–∞–≤–ª–µ–Ω: `.github/workflows/deploy-pages.yml`.
3. –ü—Ä–∏ –ø—É—à–µ –≤ –≤–µ—Ç–∫—É `main` –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è —Å–±–æ—Ä–∫–∞ `expo export --platform web`,
   —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø—É–±–ª–∏–∫—É–µ—Ç—Å—è –≤ Pages. –î–ª—è SPA –Ω–∞—Å—Ç—Ä–æ–µ–Ω fallback `404.html`.
4. –ï—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ –∫–∞—Å—Ç–æ–º–Ω—ã–π –¥–æ–º–µ–Ω, –¥–æ–±–∞–≤—å—Ç–µ `CNAME` –≤ `dist` (—à–∞–≥ –≤ workflow –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏).

–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ/—Å–µ–∫—Ä–µ—Ç—ã: –≤ —Ç–µ–∫—É—â–µ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –Ω–µ —Ç—Ä–µ–±—É—é—Ç—Å—è (–ø—É–±–ª–∏—á–Ω—ã–π –±–∏–ª–¥). –ï—Å–ª–∏ –¥–æ–±–∞–≤–∏—Ç–µ –≤–Ω–µ—à–Ω–∏–µ –∫–ª—é—á–∏/SDK ‚Äî —Ö—Ä–∞–Ω–∏—Ç—å –∏—Ö –≤ `Repository secrets` –∏ –ø—Ä–æ–∫–∏–¥—ã–≤–∞—Ç—å –≤ job env.

## üß≠ –ñ—É—Ä–Ω–∞–ª –≤–Ω–µ–¥—Ä–µ–Ω–∏—è (Implementation Log)

P0 ‚Äî –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ –ø–ª–∞—Ç–µ–∂–∏
- –î–æ–±–∞–≤–ª–µ–Ω—ã RLS‚Äë–ø–æ–ª–∏—Ç–∏–∫–∏ –∏ —Å—Ö–µ–º—ã: `supabase/schema.sql`, `supabase/rls.sql` (FORCE RLS –≤–∫–ª—é—á–∞–π—Ç–µ –≤ –ø–∞–Ω–µ–ª–∏).
- –ê—É–¥–∏—Ç: `supabase/audit.sql` ‚Äî `audit_log` + —Ç—Ä–∏–≥–≥–µ—Ä—ã –Ω–∞ –∫–ª—é—á–µ–≤—ã–µ —Ç–∞–±–ª–∏—Ü—ã.
- –ü–ª–∞—Ç–µ–∂–∏: `supabase/payments.sql` ‚Äî –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å (`idempotency_key` + `pg_advisory_xact_lock`) –∏ —Ç–∞–±–ª–∏—Ü–∞ `payments`.
- Rate limiting: `supabase/rate_limit.sql` ‚Äî —É—á—ë—Ç –ø–æ–ø—ã—Ç–æ–∫ –∏ —Ñ—É–Ω–∫—Ü–∏—è `check_rate_limit`.
- –ö–æ–º–∏—Å—Å–∏–∏: `supabase/commissions.sql` ‚Äî `commission_tiers`, `commission_history`, —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ `operators`.
- –°–µ—Ä–≤–∏—Å –∫–æ–º–∏—Å—Å–∏–π: `lib/commission.ts` ‚Äî override ‚Üí tier ‚Üí default, –ø–æ–¥–¥–µ—Ä–∂–∫–∞ min/max, –∏—Å—Ç–æ—Ä–∏—é —Ñ–∏–∫—Å–∏—Ä—É–µ–º —á–µ—Ä–µ–∑ `commission_history`.

–ö–∞–∫ –ø—Ä–∏–º–µ–Ω—è—Ç—å SQL (–ø–æ—Ä—è–¥–æ–∫):
1) `supabase/schema.sql` ‚Üí 2) `supabase/rls.sql` ‚Üí 3) `supabase/audit.sql` ‚Üí 4) `supabase/payments.sql` ‚Üí 5) `supabase/rate_limit.sql` ‚Üí 6) `supabase/commissions.sql`.

–ü—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ—Å–ª–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è:
- RLS: –∞–Ω–æ–Ω–∏–º–Ω—ã–π –∫–ª–∏–µ–Ω—Ç –Ω–µ –≤–∏–¥–∏—Ç —á—É–∂–∏–µ –¥–∞–Ω–Ω—ã–µ; –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–π –≤–∏–¥–∏—Ç —Ç–æ–ª—å–∫–æ —Å–≤–æ–∏.
- –ê—É–¥–∏—Ç: –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ `bookings`/`messages` –ø–æ–ø–∞–¥–∞—é—Ç –≤ `audit_log`.
- –ü–ª–∞—Ç–µ–∂–∏: –¥–≤–∞ –≤—ã–∑–æ–≤–∞ `create_payment_safe` —Å –æ–¥–∏–Ω–∞–∫–æ–≤—ã–º –∫–ª—é—á–æ–º ‚Äî –æ–¥–Ω–∞ –∑–∞–ø–∏—Å—å.
- –ö–æ–º–∏—Å—Å–∏–∏: `calculateCommission(amount, operatorId)` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ (override/tier/default) –∏ —Å—É–º–º—É.

## üöß –°—Ç–∞—Ç—É—Å —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

### ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ
- [x] –ë–∞–∑–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- [x] –ù–∞–≤–∏–≥–∞—Ü–∏—è —Å —Ç–∞–±–∞–º–∏
- [x] –°–∏—Å—Ç–µ–º–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
- [x] –ì–µ–æ–ª–æ–∫–∞—Ü–∏—è –∏ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è
- [x] SOS —Å–∏—Å—Ç–µ–º–∞
- [x] –û—Å–Ω–æ–≤–Ω—ã–µ —ç–∫—Ä–∞–Ω—ã (–ì–ª–∞–≤–Ω–∞—è, –ö—É–ª—å—Ç—É—Ä–∞, –≠–∫–æ–ª–æ–≥–∏—è, –ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ, –ü—Ä–æ—Ñ–∏–ª—å)
- [x] –ö–æ–Ω—Ç–µ–∫—Å—Ç—ã –∏ —Ö—É–∫–∏
- [x] UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

### üîÑ –í —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ
- [ ] –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ API
- [ ] –ö–∞—Ä—Ç—ã –∏ –º–∞—Ä—à—Ä—É—Ç—ã
- [ ] AR —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å
- [ ] Push —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
- [ ] –û—Ñ–ª–∞–π–Ω —Ä–µ–∂–∏–º

### üìã –ü–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è
- [ ] –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Supabase
- [ ] –°–∏—Å—Ç–µ–º–∞ –æ—Ç–∑—ã–≤–æ–≤
- [ ] –°–æ—Ü–∏–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
- [ ] –ú–Ω–æ–≥–æ—è–∑—ã—á–Ω–æ—Å—Ç—å
- [ ] –¢–µ–º–Ω–∞—è —Ç–µ–º–∞

## ü§ù –í–∫–ª–∞–¥ –≤ –ø—Ä–æ–µ–∫—Ç

1. –§–æ—Ä–∫–Ω–∏—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
2. –°–æ–∑–¥–∞–π—Ç–µ –≤–µ—Ç–∫—É –¥–ª—è –Ω–æ–≤–æ–π —Ñ—É–Ω–∫—Ü–∏–∏ (`git checkout -b feature/amazing-feature`)
3. –ó–∞—Ñ–∏–∫—Å–∏—Ä—É–π—Ç–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è (`git commit -m 'Add amazing feature'`)
4. –û—Ç–ø—Ä–∞–≤—å—Ç–µ –≤ –≤–µ—Ç–∫—É (`git push origin feature/amazing-feature`)
5. –û—Ç–∫—Ä–æ–π—Ç–µ Pull Request

## üìÑ –õ–∏—Ü–µ–Ω–∑–∏—è

–≠—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—è–µ—Ç—Å—è –ø–æ–¥ –ª–∏—Ü–µ–Ω–∑–∏–µ–π MIT. –°–º. —Ñ–∞–π–ª `LICENSE` –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏.

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ï—Å–ª–∏ —É –≤–∞—Å –µ—Å—Ç—å –≤–æ–ø—Ä–æ—Å—ã –∏–ª–∏ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è:
- –°–æ–∑–¥–∞–π—Ç–µ Issue –≤ GitHub
- –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ Expo
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞–∑–¥–µ–ª FAQ

## üôè –ë–ª–∞–≥–æ–¥–∞—Ä–Ω–æ—Å—Ç–∏

- –ö–æ–º–∞–Ω–¥–∞ Expo –∑–∞ –æ—Ç–ª–∏—á–Ω—É—é –ø–ª–∞—Ç—Ñ–æ—Ä–º—É
- –°–æ–æ–±—â–µ—Å—Ç–≤–æ React Native
- –í—Å–µ —É—á–∞—Å—Ç–Ω–∏–∫–∏ –ø—Ä–æ–µ–∫—Ç–∞

---

**–°–¥–µ–ª–∞–Ω–æ —Å ‚ù§Ô∏è –¥–ª—è –ø—É—Ç–µ—à–µ—Å—Ç–≤–µ–Ω–Ω–∏–∫–æ–≤ –ø–æ –ö–∞–º—á–∞—Ç–∫–µ**
