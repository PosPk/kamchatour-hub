### ЛК Туроператора (Back‑office): полное описание и функциональные требования

## Цели и ценностное предложение
- Централизованное управление турами, календарями, заявками/заказами, контентом и выплатами.
- Повышение конверсии через быстрые ответы (SLA), качественный контент и прозрачную политику отмен.
- Инструменты роста: аналитика, акции, интеграции (календарь, мессенджеры, платежи), ЭкоБаллы и фото‑лента.

## Онбординг и верификация
- Регистрация организации: название, юр. форма, ИНН/КПП/ОГРН, адрес, сайт, контакты, банковские реквизиты.
- Документы: лицензии, страховки, допуски, сертификаты проводников (сканы/PDF), сроки действия и напоминания.
- Проверка и статусы: Черновик → На проверке → Проверен → Партнёр → Официальный. История модерации.
- Брендинг: логотип, цветовая схема, краткий «About», медиа‑гайд.

## Профиль оператора (публичная карточка)
- Основная информация, направления/активности, языки гидов, рейтинг/отзывы, бейджи доверия.
- Ссылки: сайт, соцсети, виджет «Бронировать».
- Параметры SEO: slug, title/description, OpenGraph, локализации.

## Каталог туров
- Структура тура:
  - Основные поля: название, регион/локации, активность, длительность, сложность, возрастные ограничения, языки.
  - Программа/итинерарий по дням, «что включено/исключено», список снаряжения.
  - Медиа: обложка, галерея фото/видео, требования к качеству, альтернативные подписи.
  - SEO/локализации: slug, мета‑поля, multi‑lang контент.
- Шаблоны и клонирование: создание по образцу, наборы предустановок.
- Статусы: Черновик, На модерации, Опубликован, Снят с продажи.

## Ценообразование и акции
- Базовая цена, валюта, дифференциация по возрастам (взрослые/дети), наценки и доп.услуги.
- Динамика: по датам/сезонам, раннее бронирование, last‑minute, промокоды/купоны, пакеты (bundle: тур+доп.услуги).
- Политики: предоплата (%/фикс), сроки окончательного платежа, штрафы за отмену/перенос.

## Календарь и квоты
- Слоты: дата/время начала и конца, вместимость, минимальная/максимальная группа, стоп‑продажи.
- Массовые операции: серия дат (RRULE), копирование цен/квот, закрытие диапазонов.
- Импорт/синхронизация: CSV/Google Sheets/API (см. Интеграции).

## Лиды и заявки
- Источники: публичная форма на портале, виджет на сайте оператора, мессенджеры, e‑mail.
- Карточка лида: контакты, запрос, источник (UTM), присвоенный менеджер, приоритет.
- Действия: квалификация, ответы по шаблонам, вложения, конвертация в заказ.
- SLA: таймер отклика, эскалация, авто‑уведомления клиенту.

## Заказы и бронирования
- Статусы: Черновик → Ожидает оплаты → Подтверждено → Выполнено → Отменено/Возврат.
- Состав: выбранный слот, участники (профили/паспортные поля), доп.услуги, итоговая цена.
- Платежи/возвраты: предоплата/постоплата, график, транзакции, частичные/полные возвраты.
- Документы: договор, счёт, чек/квитанция, ваучер с QR, инструкция (PDF), история версий.
- Место встречи: адрес + координаты, карта, заметки для клиента, контакты гида.

## Коммуникации (Inbox)
- Треды «клиент↔оператор»: текст, шаблоны ответов, вложения, быстрые реакции.
- Уведомления: in‑app, e‑mail, (опц.) Telegram/WhatsApp.
- Правила автоматизации: авто‑ответы вне часов работы, подтверждение получения, напоминания об оплате/дате.

## Финансы и выплаты
- Комиссии портала, отчёты по периодам, акты, реестры выплат.
- Экспорт в бухгалтерию (CSV/1C), сверки, налоги.
- Управление реквизитами и валютами, курсы.

## Отзывы и модерация
- Сбор отзывов после поездки, публикация на карточке тура/оператора.
- Модерация контента: спам/нарушения, ответы оператора, апелляции.

## Аналитика
- Воронка: показы → клики → лиды → заказы → оплаты.
- Источники трафика (UTM), эффективность акций/промокодов.
- SLA ответов, загрузка слотов, средний чек, возвраты, NPS.

## Команда и доступы
- Роли: Владелец, Менеджер продаж, Операционный менеджер, Контент‑редактор, Бухгалтер, Гид.
- Разграничение прав: туры/календарь/заказы/финансы/аналитика; аудит логов действий.

## Интеграции
- Календарь: CSV/Google Sheets/API; маппинг полей (дата, квоты, цена, статус).
- Мессенджеры: Telegram/WhatsApp через провайдеров; webhook для уведомлений.
- Платежи: эквайринг/СПБ; webhooks о статусах платежей/возвратов.
- Хранилище медиа: S3/CDN, оптимизация (ресайз/веб‑форматы), модерация.
- Виджет «Бронировать»: скрипт/iframe с конфигурируемым брендингом.

## ЭкоБаллы (интеграция)
- Создание эко‑действий в рамках туров (уборка/квест/ресайклинг), условия начисления, лимиты.
- Подтверждение: QR‑чек‑ин на локации, геофенс, подтверждение менеджером, проверка фото‑доказательств.
- Награды: баллы, бейджи, вклад клиента в «зелёный рейтинг» оператора.
- Отчёты: вклад операторов в устойчивый туризм (PR/партнёрские программы).

## Фото‑лента (интеграция)
- Призывы к участникам делиться фото с тегом/упоминанием оператора.
- Модерация пользовательского контента, правила публикации, согласия.
- Витрина: закреплённые посты на карточке туров, галерея «после поездки».

## Политики отмен/переносов
- Конфиг: сроки и штрафы, гибкие/умеренные/жёсткие шаблоны.
- Автоматизация: дорасчёт штрафов, триггеры возвратов, информирование всех сторон.

## Процессы и SLA
- Лид: создание → квалификация (≤ 1 рабочий день) → конвертация в заказ.
- Заказ: подтверждение дат → оплата → выпуск документов → проведение тура → отзыв.
- Возврат: запрос → проверка → расчёт → выплата (сроки по тарифу).

## Модель данных (сокращённо)
- Operator(id, name, brand, contacts, verifiedStatus, partnerLevel, score, socials, legal, payoutDetails)
- Tour(id, operatorId, title, region, activity, duration, difficulty, languages[], media[], includes[], excludes[], seo, status)
- Slot(id, tourId, start, end, capacity, minGroup, maxGroup, price, currency, stopSale)
- Lead(id, operatorId, source, contact, message, assigneeId, status, utm, createdAt)
- Booking(id, tourId, slotId, operatorId, userId, travelers[], addons[], total, currency, status, policyId)
- Payment(id, bookingId, amount, currency, status, method, refundId?)
- Document(id, bookingId, type, url, version, createdAt)
- Message(id, threadId, author, text, attachments[], createdAt)
- Thread(id, operatorId, userId, lastMessage, updatedAt)
- EcoAction(id, operatorId, tourId?, type, points, evidenceUrl, geo, verified, userId)
- FeedPost(id, operatorId?, userId, imageUrl, caption, tags[], createdAt, likes)

## API (набросок)
- GET /operators/:id, PATCH /operators/:id
- CRUD: /tours, /tours/:id/slots
- Leads: POST /leads, PATCH /leads/:id (assign/status)
- Bookings: POST/GET/PATCH /bookings, /bookings/:id/documents, /bookings/:id/refunds
- Payments: /payments/webhook, /refunds
- Messages: /threads, /threads/:id/messages
- Eco: /eco/actions (verify/award), /eco/stats
- Feed: /feed (moderation)

## Дорожная карта
- Этап 1 (MVP): Онбординг, туры, календарь, лиды→заказы, документы/ваучер, сообщения, базовые выплаты.
- Этап 2: Акции/промо, возвраты, расширенная аналитика, виджет, интеграции мессенджеров.
- Этап 3: ЭкоБаллы с верификацией, фото‑лента с модерацией, сложные политики, мультивалюта.

## Критерии готовности (DoD)
- Все разделы защищены правами доступа, пройдены критические UX‑сценарии.
- Стабильные API и схемы данных, покрыты автотестами важные потоки.
- Документация для операторов (гайд по контенту/календарю/политикам/выплатам).

